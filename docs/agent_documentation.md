# Документация агента Kharebeney

## Общее описание
Kharebeney - это искусственный интеллект для микроконтроллера ESP32, реализованный в форме виртуального питомца (tamagotchi). Агент обладает эмоциями, системой обучения, памятью, жизненным циклом и системой векторных представлений (эмбеддингов) для более умного анализа ситуаций.

## Архитектура

### Основные компоненты

#### 1. InternalState (Система внутренних состояний)
- hunger (голод): 0.0-1.0
- happiness (счастье): 0.0-1.0
- health (здоровье): 0.0-1.0
- energy (энергия): 0.0-1.0
- social (социальность): 0.0-1.0
- curiosity (любопытство): 0.0-1.0
- level (уровень): целое число
- age (возраст): число секунд

#### 2. EmotionSystem (Система эмоций)
- joy (радость)
- apathy (апатия)
- discontent (недовольство)
- capricious (капризность)
- anger (сердитость)
- satisfaction (довольство)
- curiosity (любопытство)
- fear (страх)
- excitement (возбуждение)
- calm (спокойствие)
- loneliness (одиночество)
- love (любовь)

#### 3. LearningSystem (Система обучения)
- problem_solving (решение проблем)
- social_interaction (социальное взаимодействие)
- emotional_intelligence (эмоциональный интеллект)
- creativity (креативность)
- adaptability (адаптивность)
- memory (память)
- attention (внимание)
- patience (терпение)

#### 4. DecisionEngine (Движок принятия решений)
- feed (покормить)
- play (поиграть)
- heal (вылечить)
- rest (отдых)
- socialize (общение)
- explore (исследовать)
- wait (ожидание)

#### 5. MemorySystem (Система памяти)
Хранит важные события и действия агента с контекстом и эмоциями

#### 6. LifecycleSystem (Система жизненного цикла)
Управляет стадиями развития: newborn, child, teenager, adult, elder

#### 7. BalanceManager (Менеджер баланса)
Управляет балансом между исследованием (exploration) и эксплуатацией (exploitation)

#### 8. EmbeddingSystem (Система векторных представлений)
- 8-мерные эмбеддинги для представления состояний агента
- Косинусное сходство для определения похожих ситуаций
- Преобразование между внутренними состояниями и векторными представлениями
- Используется для семантического поиска в памяти и улучшения принятия решений

## Интерфейс

### Основные методы
- `update()` - обновление состояния агента
- `get_internal_states()` - получение текущих внутренних состояний
- `get_emotional_description()` - получение описания текущего эмоционального состояния
- `trigger_emotion(emotion, intensity)` - вызвать эмоцию
- `set_prompt(prompt_type, content)` - установить промт
- `search_memories(query)` - поиск в памяти по строковому запросу
- `save_state(filename)` - сохранить состояние
- `load_state(filename)` - загрузить состояние
- `get_learning_insights()` - получить рекомендации от системы обучения

## Файловая структура
```
main/
├── main.cpp                    # Точка запуска
├── config.h                    # Конфигурация пинов и параметров
├── core/                       # Основные модули агента
│   ├── kharebeney_agent.h      # Основной класс агента
│   ├── kharebeney_agent.cpp
│   ├── internal_state.h        # Система внутренних состояний
│   ├── internal_state.cpp
│   ├── emotion_system.h        # Система эмоций
│   ├── emotion_system.cpp
│   ├── learning_system.h       # Система обучения
│   ├── learning_system.cpp
│   ├── simple_systems.h        # Вспомогательные системы (KnowledgeBase, DecisionEngine, LifecycleSystem, MemorySystem, PromptSystem)
│   ├── simple_systems.cpp
│   ├── balance_manager.h       # Менеджер баланса
│   ├── balance_manager.cpp
│   └── embedding.h             # Система векторных представлений
│   └── embedding.cpp
├── lib/                        # Вспомогательные библиотеки
│   └── utlis.h                 # Вспомогательные функции
│   └── utlis.cpp
├── screen/                     # Экраны интерфейса
│   ├── menu.h
│   ├── menu.cpp
│   ├── main/
│   ├── food/
│   ├── game/
│   ├── medicine/
│   ├── toilet/
│   ├── status/
│   ├── study/
│   ├── discipline/
│   └── settings/
│       └── screen_settings.h
│       └── screen_settings.cpp
└── fonts/                      # Шрифты иконки
    └── icons.h
```

## Система эмбеддингов

### Основные особенности
- 8-мерные векторы для представления состояний агента
- Время вычисления косинусного сходства: ~46 мкс на ESP32
- Преобразование между 6 внутренними состояниями и 8-мерным эмбеддингом
- Дополнительные признаки: комбинации базовых состояний для улучшения представления

### Использование
- Сравнение текущего состояния с прошлыми ситуациями
- Семантический поиск в памяти
- Улучшение принятия решений через анализ похожих ситуаций
- Оценка сходства различных сценариев поведения

## Оптимизации
- Ограниченное количество состояний и эмоций для экономии памяти
- Низкое потребление памяти для векторных представлений (32 байта на эмбеддинг)
- Ограниченная история действий и воспоминаний
- Простые алгоритмы для микроконтроллера
- Эффективные операции с векторами для ESP32