# Промт для реализации системы генерации текста с базой знаний на ESP32

## Цель
Реализовать систему генерации текстовых ответов для агента Kharebeney AI, которая учитывает его текущие эмоции и состояния, с использованием базы знаний размером до 1 МБ на микроконтроллере ESP32 (512 КБ ОЗУ, 4 МБ Flash).

## Архитектурные ограничения
- Общая память: 512 КБ SRAM, 4 МБ Flash
- Текущая система агента использует ~50-100 КБ
- Остается ~412 КБ для новых функций
- База знаний: 1 МБ (хранится во Flash)
- Процессор: ESP32 (2 ядра, 240 МГц)

## Требования к системе

### 1. Система генерации текста
- Генерация ответов на основе текущего эмоционального состояния
- Учет внутренних состояний агента (голод, счастье, здоровье и т.д.)
- Контекстно-зависимые ответы
- Интеграция с существующими системами агента

### 2. Эффективное извлечение из базы знаний
- Использование гибридного подхода: индексация + семантический поиск
- Хранение базы знаний во Flash-памяти
- Создание компактного индекса в ОЗУ (~50-100 КБ)
- Постраничная загрузка релевантных данных в память
- Использование существующей системы эмбеддингов для семантического поиска

### 3. Структура данных
- Компактные структуры для экономии памяти
- Эффективные алгоритмы поиска и сортировки
- Оптимизация доступа к Flash-памяти
- Кеширование часто используемых данных

## Рекомендуемая реализация

### 1. Класс SpeechSystem
```cpp
class SpeechSystem {
private:
    KharebeneyAgent* agent;
    // Компактный индекс для поиска
    // Кеш для часто используемых фраз
    // Временные буферы для обработки
    
public:
    std::string generate_response(const std::string& input = "");
    std::string describe_current_state();
    void learn_from_interaction(const std::string& input, const std::string& response, float satisfaction);
};
```

### 2. Методы извлечения из базы знаний
- Поиск по ключевым словам через индекс
- Семантический поиск через эмбеддинги
- Фильтрация по релевантности
- Загрузка и возврат релевантных фраз

### 3. Интеграция с существующими системами
- Использование `get_emotional_description()` для получения эмоционального состояния
- Использование `get_internal_states()` для получения текущих состояний
- Использование `search_memories_by_embedding()` для контекстного поиска
- Использование `EmbeddingConverter` для семантического анализа

## Оптимизация ресурсов
- Максимальное использование Flash-памяти для хранения данных
- Минимизация использования ОЗУ
- Эффективные алгоритмы поиска для работы с большими базами данных
- Кеширование результатов для повторного использования
- Постраничная загрузка данных по требованию

## Примеры генерации
- При высоком уровне счастья: "У меня отличное настроение сегодня!"
- При голоде: "Я чувствую голод, мне нужно что-нибудь съесть"
- При эмоции радости: "Я рад, что мы можем поговорить!"
- При высокой социальности: "Мне не хватает общения, давай поболтаем!"

## Критерии успеха
- Система эффективно работает в рамках ограничений памяти
- Ответы логично связаны с текущим состоянием агента
- Время отклика приемлемо для интерактивного взаимодействия
- Система интегрирована с существующими компонентами агента
- Сохранена стабильность работы всего агента